<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Multilevel models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="index_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="index_files/libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional resources</a></li>
  <li><a href="#setup-environment" id="toc-setup-environment" class="nav-link" data-scroll-target="#setup-environment">Setup environment</a></li>
  <li><a href="#background-information" id="toc-background-information" class="nav-link" data-scroll-target="#background-information">Background information</a></li>
  <li><a href="#complete-pooling" id="toc-complete-pooling" class="nav-link" data-scroll-target="#complete-pooling">Complete pooling</a>
  <ul class="collapse">
  <li><a href="#maximum-likelihood-frequentist-estimates" id="toc-maximum-likelihood-frequentist-estimates" class="nav-link" data-scroll-target="#maximum-likelihood-frequentist-estimates">Maximum-likelihood (frequentist) estimates</a></li>
  <li><a href="#statistical-model-and-bayesian-estimates" id="toc-statistical-model-and-bayesian-estimates" class="nav-link" data-scroll-target="#statistical-model-and-bayesian-estimates">Statistical model and Bayesian estimates</a></li>
  </ul></li>
  <li><a href="#no-pooling" id="toc-no-pooling" class="nav-link" data-scroll-target="#no-pooling">No pooling</a>
  <ul class="collapse">
  <li><a href="#maximum-likelihood-frequentist-estimates-1" id="toc-maximum-likelihood-frequentist-estimates-1" class="nav-link" data-scroll-target="#maximum-likelihood-frequentist-estimates-1">Maximum-likelihood (frequentist) estimates</a></li>
  <li><a href="#statistical-model-and-bayesian-estimates-1" id="toc-statistical-model-and-bayesian-estimates-1" class="nav-link" data-scroll-target="#statistical-model-and-bayesian-estimates-1">Statistical model and Bayesian estimates</a></li>
  </ul></li>
  <li><a href="#partial-pooling-mixed-model-random-intercept-and-slope" id="toc-partial-pooling-mixed-model-random-intercept-and-slope" class="nav-link" data-scroll-target="#partial-pooling-mixed-model-random-intercept-and-slope">Partial pooling (mixed model, random intercept and slope)</a>
  <ul class="collapse">
  <li><a href="#maximum-likelihood-frequentist-estimates-2" id="toc-maximum-likelihood-frequentist-estimates-2" class="nav-link" data-scroll-target="#maximum-likelihood-frequentist-estimates-2">Maximum-likelihood (frequentist) estimates</a></li>
  <li><a href="#statistical-model-and-bayesian-estimates-2" id="toc-statistical-model-and-bayesian-estimates-2" class="nav-link" data-scroll-target="#statistical-model-and-bayesian-estimates-2">Statistical model and Bayesian estimates</a></li>
  </ul></li>
  <li><a href="#partial-pooling-mixed-model-random-intercept-and-fixed-slope" id="toc-partial-pooling-mixed-model-random-intercept-and-fixed-slope" class="nav-link" data-scroll-target="#partial-pooling-mixed-model-random-intercept-and-fixed-slope">Partial pooling (mixed model, random intercept and fixed slope)</a>
  <ul class="collapse">
  <li><a href="#maximum-likelihood-frequentist-estimates-3" id="toc-maximum-likelihood-frequentist-estimates-3" class="nav-link" data-scroll-target="#maximum-likelihood-frequentist-estimates-3">Maximum-likelihood (frequentist) estimates</a></li>
  <li><a href="#statistical-model-and-bayesian-estimates-3" id="toc-statistical-model-and-bayesian-estimates-3" class="nav-link" data-scroll-target="#statistical-model-and-bayesian-estimates-3">Statistical model and Bayesian estimates</a></li>
  </ul></li>
  <li><a href="#partial-pooling-mixed-model-fixed-intercept-and-random-slope" id="toc-partial-pooling-mixed-model-fixed-intercept-and-random-slope" class="nav-link" data-scroll-target="#partial-pooling-mixed-model-fixed-intercept-and-random-slope">Partial pooling (mixed model, fixed intercept and random slope)</a>
  <ul class="collapse">
  <li><a href="#maximum-likelihood-frequentist-estimates-4" id="toc-maximum-likelihood-frequentist-estimates-4" class="nav-link" data-scroll-target="#maximum-likelihood-frequentist-estimates-4">Maximum-likelihood (frequentist) estimates</a></li>
  <li><a href="#statistical-model-and-bayesian-estimates-4" id="toc-statistical-model-and-bayesian-estimates-4" class="nav-link" data-scroll-target="#statistical-model-and-bayesian-estimates-4">Statistical model and Bayesian estimates</a></li>
  </ul></li>
  <li><a href="#compare-models" id="toc-compare-models" class="nav-link" data-scroll-target="#compare-models">Compare models</a></li>
  <li><a href="#print-environment" id="toc-print-environment" class="nav-link" data-scroll-target="#print-environment">Print environment</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Multilevel models</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This notebook illustrates an additional example of how to use fixed and mixed effects/multilevel models (incl.&nbsp;the actual statistical models underlying each model formula), which were illustrated during the lecture of week 12 (2025-03-31, <strong>Chapter 10: More models with interactions</strong>) by <a href="https://www.angelaradulescu.com/">Angela Radulescu</a>.</p>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional resources</h2>
<ul>
<li><p><a href="http://mfviz.com/hierarchical-models/">Visual explanation of hierarchical modeling</a></p></li>
<li><p><a href="https://nicholasrjenkins.science/tutorials/bayesian-inference-with-stan/mm_stan/">Pooling, No Pooling, and Partial Pooling</a></p></li>
<li><p><a href="https://m-clark.github.io/mixed-models-with-R/">Mixed Models with R: Getting started with random effects</a></p></li>
<li><p><a href="https://ourcodingclub.github.io/tutorials/mixed-models/">Introduction to linear mixed models</a></p></li>
<li><p><a href="https://andrewcparnell.github.io/bhm_course/">Introduction to Bayesian hierarchical modelling using R</a></p></li>
<li><p><a href="https://doi.org/10.18637/jss.v067.i01">Fitting linear mixed-effects models using lme4</a></p></li>
</ul>
</section>
<section id="setup-environment" class="level2">
<h2 class="anchored" data-anchor-id="setup-environment">Setup environment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking) <span class="co"># https://github.com/rmcelreath/rethinking</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)   <span class="co"># https://mc-stan.org/rstanarm/ (see also: https://paulbuerkner.com/brms/)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">1</span>, <span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1969</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="background-information" class="level2">
<h2 class="anchored" data-anchor-id="background-information">Background information</h2>
<p>The data represents the average reaction time per day for subjects in a sleep deprivation study. On day 0 the subjects had their normal amount of sleep. Starting that night they were restricted to 3 hours of sleep per night. The observations represent the average reaction time on a series of tests given each day to each subject. Basically a repeated measures design.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sleepstudy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Reaction"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Days"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Subject"],"name":[3],"type":["fct"],"align":["left"]}],"data":[{"1":"249.6","2":"0","3":"308"},{"1":"258.7","2":"1","3":"308"},{"1":"250.8","2":"2","3":"308"},{"1":"321.4","2":"3","3":"308"},{"1":"356.9","2":"4","3":"308"},{"1":"414.7","2":"5","3":"308"},{"1":"382.2","2":"6","3":"308"},{"1":"290.1","2":"7","3":"308"},{"1":"430.6","2":"8","3":"308"},{"1":"466.4","2":"9","3":"308"},{"1":"222.7","2":"0","3":"309"},{"1":"205.3","2":"1","3":"309"},{"1":"203.0","2":"2","3":"309"},{"1":"204.7","2":"3","3":"309"},{"1":"207.7","2":"4","3":"309"},{"1":"216.0","2":"5","3":"309"},{"1":"213.6","2":"6","3":"309"},{"1":"217.7","2":"7","3":"309"},{"1":"224.3","2":"8","3":"309"},{"1":"237.3","2":"9","3":"309"},{"1":"199.1","2":"0","3":"310"},{"1":"194.3","2":"1","3":"310"},{"1":"234.3","2":"2","3":"310"},{"1":"232.8","2":"3","3":"310"},{"1":"229.3","2":"4","3":"310"},{"1":"220.5","2":"5","3":"310"},{"1":"235.4","2":"6","3":"310"},{"1":"255.8","2":"7","3":"310"},{"1":"261.0","2":"8","3":"310"},{"1":"247.5","2":"9","3":"310"},{"1":"321.5","2":"0","3":"330"},{"1":"300.4","2":"1","3":"330"},{"1":"283.9","2":"2","3":"330"},{"1":"285.1","2":"3","3":"330"},{"1":"285.8","2":"4","3":"330"},{"1":"297.6","2":"5","3":"330"},{"1":"280.2","2":"6","3":"330"},{"1":"318.3","2":"7","3":"330"},{"1":"305.3","2":"8","3":"330"},{"1":"354.0","2":"9","3":"330"},{"1":"287.6","2":"0","3":"331"},{"1":"285.0","2":"1","3":"331"},{"1":"301.8","2":"2","3":"331"},{"1":"320.1","2":"3","3":"331"},{"1":"316.3","2":"4","3":"331"},{"1":"293.3","2":"5","3":"331"},{"1":"290.1","2":"6","3":"331"},{"1":"334.8","2":"7","3":"331"},{"1":"293.7","2":"8","3":"331"},{"1":"371.6","2":"9","3":"331"},{"1":"234.9","2":"0","3":"332"},{"1":"242.8","2":"1","3":"332"},{"1":"273.0","2":"2","3":"332"},{"1":"309.8","2":"3","3":"332"},{"1":"317.5","2":"4","3":"332"},{"1":"310.0","2":"5","3":"332"},{"1":"454.2","2":"6","3":"332"},{"1":"346.8","2":"7","3":"332"},{"1":"330.3","2":"8","3":"332"},{"1":"253.9","2":"9","3":"332"},{"1":"283.8","2":"0","3":"333"},{"1":"289.6","2":"1","3":"333"},{"1":"276.8","2":"2","3":"333"},{"1":"299.8","2":"3","3":"333"},{"1":"297.2","2":"4","3":"333"},{"1":"338.2","2":"5","3":"333"},{"1":"332.0","2":"6","3":"333"},{"1":"348.8","2":"7","3":"333"},{"1":"333.4","2":"8","3":"333"},{"1":"362.0","2":"9","3":"333"},{"1":"265.5","2":"0","3":"334"},{"1":"276.2","2":"1","3":"334"},{"1":"243.4","2":"2","3":"334"},{"1":"254.7","2":"3","3":"334"},{"1":"279.0","2":"4","3":"334"},{"1":"284.2","2":"5","3":"334"},{"1":"305.5","2":"6","3":"334"},{"1":"331.5","2":"7","3":"334"},{"1":"335.7","2":"8","3":"334"},{"1":"377.3","2":"9","3":"334"},{"1":"241.6","2":"0","3":"335"},{"1":"273.9","2":"1","3":"335"},{"1":"254.5","2":"2","3":"335"},{"1":"270.8","2":"3","3":"335"},{"1":"251.5","2":"4","3":"335"},{"1":"254.6","2":"5","3":"335"},{"1":"245.5","2":"6","3":"335"},{"1":"235.3","2":"7","3":"335"},{"1":"235.8","2":"8","3":"335"},{"1":"237.2","2":"9","3":"335"},{"1":"312.4","2":"0","3":"337"},{"1":"313.8","2":"1","3":"337"},{"1":"291.6","2":"2","3":"337"},{"1":"346.1","2":"3","3":"337"},{"1":"365.7","2":"4","3":"337"},{"1":"391.8","2":"5","3":"337"},{"1":"404.3","2":"6","3":"337"},{"1":"416.7","2":"7","3":"337"},{"1":"455.9","2":"8","3":"337"},{"1":"458.9","2":"9","3":"337"},{"1":"236.1","2":"0","3":"349"},{"1":"230.3","2":"1","3":"349"},{"1":"238.9","2":"2","3":"349"},{"1":"254.9","2":"3","3":"349"},{"1":"250.7","2":"4","3":"349"},{"1":"269.8","2":"5","3":"349"},{"1":"281.6","2":"6","3":"349"},{"1":"308.1","2":"7","3":"349"},{"1":"336.3","2":"8","3":"349"},{"1":"351.6","2":"9","3":"349"},{"1":"256.3","2":"0","3":"350"},{"1":"243.5","2":"1","3":"350"},{"1":"256.2","2":"2","3":"350"},{"1":"255.5","2":"3","3":"350"},{"1":"268.9","2":"4","3":"350"},{"1":"329.7","2":"5","3":"350"},{"1":"379.4","2":"6","3":"350"},{"1":"362.9","2":"7","3":"350"},{"1":"394.5","2":"8","3":"350"},{"1":"389.1","2":"9","3":"350"},{"1":"250.5","2":"0","3":"351"},{"1":"300.1","2":"1","3":"351"},{"1":"269.9","2":"2","3":"351"},{"1":"280.6","2":"3","3":"351"},{"1":"271.8","2":"4","3":"351"},{"1":"304.6","2":"5","3":"351"},{"1":"287.7","2":"6","3":"351"},{"1":"266.6","2":"7","3":"351"},{"1":"321.5","2":"8","3":"351"},{"1":"347.6","2":"9","3":"351"},{"1":"221.7","2":"0","3":"352"},{"1":"298.2","2":"1","3":"352"},{"1":"326.9","2":"2","3":"352"},{"1":"346.9","2":"3","3":"352"},{"1":"348.7","2":"4","3":"352"},{"1":"352.8","2":"5","3":"352"},{"1":"354.4","2":"6","3":"352"},{"1":"360.4","2":"7","3":"352"},{"1":"375.6","2":"8","3":"352"},{"1":"388.5","2":"9","3":"352"},{"1":"271.9","2":"0","3":"369"},{"1":"268.4","2":"1","3":"369"},{"1":"257.2","2":"2","3":"369"},{"1":"277.7","2":"3","3":"369"},{"1":"314.8","2":"4","3":"369"},{"1":"317.2","2":"5","3":"369"},{"1":"298.1","2":"6","3":"369"},{"1":"348.1","2":"7","3":"369"},{"1":"340.3","2":"8","3":"369"},{"1":"366.5","2":"9","3":"369"},{"1":"225.3","2":"0","3":"370"},{"1":"234.5","2":"1","3":"370"},{"1":"238.9","2":"2","3":"370"},{"1":"240.5","2":"3","3":"370"},{"1":"267.5","2":"4","3":"370"},{"1":"344.2","2":"5","3":"370"},{"1":"281.1","2":"6","3":"370"},{"1":"347.6","2":"7","3":"370"},{"1":"365.2","2":"8","3":"370"},{"1":"372.2","2":"9","3":"370"},{"1":"269.9","2":"0","3":"371"},{"1":"272.4","2":"1","3":"371"},{"1":"277.9","2":"2","3":"371"},{"1":"281.8","2":"3","3":"371"},{"1":"279.2","2":"4","3":"371"},{"1":"284.5","2":"5","3":"371"},{"1":"259.3","2":"6","3":"371"},{"1":"304.6","2":"7","3":"371"},{"1":"350.8","2":"8","3":"371"},{"1":"369.5","2":"9","3":"371"},{"1":"269.4","2":"0","3":"372"},{"1":"273.5","2":"1","3":"372"},{"1":"297.6","2":"2","3":"372"},{"1":"310.6","2":"3","3":"372"},{"1":"287.2","2":"4","3":"372"},{"1":"329.6","2":"5","3":"372"},{"1":"334.5","2":"6","3":"372"},{"1":"343.2","2":"7","3":"372"},{"1":"369.1","2":"8","3":"372"},{"1":"364.1","2":"9","3":"372"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">as.list</span>(sleepstudy) <span class="co"># for use with ulam()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="complete-pooling" class="level2">
<h2 class="anchored" data-anchor-id="complete-pooling">Complete pooling</h2>
<p>One line (in dark gray) to fit all data points irrespective of subject, i.e., no subject information is used by this model.</p>
<section id="maximum-likelihood-frequentist-estimates" class="level3">
<h3 class="anchored" data-anchor-id="maximum-likelihood-frequentist-estimates">Maximum-likelihood (frequentist) estimates</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>complete.pooling.fit <span class="ot">=</span> <span class="fu">lm</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days, <span class="at">data =</span> sleepstudy)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(complete.pooling.fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"251.41","3":"6.610","4":"38.033","5":"2.157e-87","6":"238.361","7":"264.45"},{"1":"Days","2":"10.47","3":"1.238","4":"8.454","5":"9.894e-15","6":"8.024","7":"12.91"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(complete.pooling.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sleepstudy, <span class="fu">aes</span>(<span class="at">x =</span> Days, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"darkgray"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sleepstudy<span class="sc">$</span>complete.pooling.fit <span class="ot">=</span> <span class="fu">fitted</span>(complete.pooling.fit)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the model results</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sleepstudy, <span class="fu">aes</span>(<span class="at">x =</span> Days, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> complete.pooling.fit), <span class="at">color =</span> <span class="st">"darkgray"</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="statistical-model-and-bayesian-estimates" class="level3">
<h3 class="anchored" data-anchor-id="statistical-model-and-bayesian-estimates">Statistical model and Bayesian estimates</h3>
<p><span class="math display">\[
\begin{aligned}
  \text{Reaction}_i &amp;\sim \text{Normal}(\mu_i, \sigma) \\
  \mu_i &amp;= \alpha + \beta \times \text{Days}_i \\
  \alpha &amp;\sim \text{Normal}(250, 100) \\
  \beta &amp;\sim \text{Normal}(0, 100) \\
  \sigma &amp;\sim \text{Exponential}(0.1)
\end{aligned}
\]</span></p>
<ul>
<li><span class="math inline">\(\alpha\)</span> is the <strong>global intercept</strong> (average reaction time when <span class="math inline">\(\text{Days}=0\)</span>)</li>
<li><span class="math inline">\(\beta\)</span> is the <strong>global slope</strong> (effect of <span class="math inline">\(\text{Days}\)</span> on reaction time)</li>
<li><span class="math inline">\(\sigma\)</span> is the residual standard deviation</li>
<li><span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are shared across all subjects, meaning there is <strong>no individual variation</strong> in intercepts or slopes</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>complete.pooling.fit <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    Reaction <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> Days,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">250</span>, <span class="dv">100</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(complete.pooling.fit, <span class="at">depth =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["5.5%"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["94.5%"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["rhat"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["ess_bulk"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"251.11","2":"6.505","3":"240.768","4":"261.51","5":"1.002","6":"831.3","_rn_":"a"},{"1":"10.52","2":"1.237","3":"8.498","4":"12.47","5":"1.002","6":"822.1","_rn_":"b"},{"1":"47.43","2":"2.478","3":"43.592","4":"51.62","5":"1.002","6":"949.8","_rn_":"sigma"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Instead of using the <code>ulam()</code> function from the <code>rethinking</code> package, you can the <code>stan_glm()</code> function from the <code>rstanarm</code> package to fit the Bayesian model using the <code>lm</code> syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>complete.pooling.fit <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days, <span class="at">data =</span> sleepstudy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(complete.pooling.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"251.34","3":"6.504"},{"1":"Days","2":"10.48","3":"1.231"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(complete.pooling.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="no-pooling" class="level2">
<h2 class="anchored" data-anchor-id="no-pooling">No pooling</h2>
<p>One line for each subject (in blue). No information is shared across subjects, same as fitting a model independently for each subject, i.e., stratification.</p>
<section id="maximum-likelihood-frequentist-estimates-1" class="level3">
<h3 class="anchored" data-anchor-id="maximum-likelihood-frequentist-estimates-1">Maximum-likelihood (frequentist) estimates</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>no.pooling.fit <span class="ot">=</span> <span class="fu">lm</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">+</span> Subject <span class="sc">+</span> Days<span class="sc">:</span>Subject, <span class="at">data =</span> sleepstudy)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(no.pooling.fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"244.193","3":"15.042","4":"16.2344","5":"2.419e-34","6":"214.4616","7":"273.9237"},{"1":"Days","2":"21.765","3":"2.818","4":"7.7246","5":"1.742e-12","6":"16.1956","7":"27.3338"},{"1":"Subject309","2":"-39.138","3":"21.272","4":"-1.8399","5":"6.785e-02","6":"-81.1837","7":"2.9083"},{"1":"Subject310","2":"-40.708","3":"21.272","4":"-1.9137","5":"5.764e-02","6":"-82.7545","7":"1.3376"},{"1":"Subject330","2":"45.492","3":"21.272","4":"2.1386","5":"3.416e-02","6":"3.4464","7":"87.5384"},{"1":"Subject331","2":"41.546","3":"21.272","4":"1.9531","5":"5.275e-02","6":"-0.4997","7":"83.5923"},{"1":"Subject332","2":"20.059","3":"21.272","4":"0.9430","5":"3.473e-01","6":"-21.9871","7":"62.1050"},{"1":"Subject333","2":"30.826","3":"21.272","4":"1.4491","5":"1.495e-01","6":"-11.2196","7":"72.8725"},{"1":"Subject334","2":"-4.030","3":"21.272","4":"-0.1894","5":"8.500e-01","6":"-46.0758","7":"38.0163"},{"1":"Subject335","2":"18.842","3":"21.272","4":"0.8858","5":"3.772e-01","6":"-23.2040","7":"60.8880"},{"1":"Subject337","2":"45.911","3":"21.272","4":"2.1583","5":"3.256e-02","6":"3.8654","7":"87.9575"},{"1":"Subject349","2":"-29.081","3":"21.272","4":"-1.3671","5":"1.737e-01","6":"-71.1269","7":"12.9651"},{"1":"Subject350","2":"-18.358","3":"21.272","4":"-0.8630","5":"3.896e-01","6":"-60.4041","7":"23.6880"},{"1":"Subject351","2":"16.954","3":"21.272","4":"0.7970","5":"4.268e-01","6":"-25.0917","7":"59.0004"},{"1":"Subject352","2":"32.179","3":"21.272","4":"1.5127","5":"1.325e-01","6":"-9.8666","7":"74.2254"},{"1":"Subject369","2":"10.775","3":"21.272","4":"0.5066","5":"6.132e-01","6":"-31.2705","7":"52.8215"},{"1":"Subject370","2":"-33.744","3":"21.272","4":"-1.5863","5":"1.149e-01","6":"-75.7896","7":"8.3024"},{"1":"Subject371","2":"9.443","3":"21.272","4":"0.4439","5":"6.578e-01","6":"-32.6026","7":"51.4894"},{"1":"Subject372","2":"22.852","3":"21.272","4":"1.0743","5":"2.845e-01","6":"-19.1939","7":"64.8981"},{"1":"Days:Subject309","2":"-19.503","3":"3.985","4":"-4.8945","5":"2.609e-06","6":"-27.3789","7":"-11.6270"},{"1":"Days:Subject310","2":"-15.650","3":"3.985","4":"-3.9275","5":"1.327e-04","6":"-23.5257","7":"-7.7739"},{"1":"Days:Subject330","2":"-18.757","3":"3.985","4":"-4.7072","5":"5.841e-06","6":"-26.6326","7":"-10.8807"},{"1":"Days:Subject331","2":"-16.499","3":"3.985","4":"-4.1406","5":"5.875e-05","6":"-24.3746","7":"-8.6227"},{"1":"Days:Subject332","2":"-12.198","3":"3.985","4":"-3.0612","5":"2.630e-03","6":"-20.0739","7":"-4.3220"},{"1":"Days:Subject333","2":"-12.623","3":"3.985","4":"-3.1678","5":"1.876e-03","6":"-20.4986","7":"-4.7467"},{"1":"Days:Subject334","2":"-9.512","3":"3.985","4":"-2.3871","5":"1.828e-02","6":"-17.3875","7":"-1.6356"},{"1":"Days:Subject335","2":"-24.646","3":"3.985","4":"-6.1852","5":"6.072e-09","6":"-32.5217","7":"-16.7698"},{"1":"Days:Subject337","2":"-2.739","3":"3.985","4":"-0.6873","5":"4.930e-01","6":"-10.6147","7":"5.1372"},{"1":"Days:Subject349","2":"-8.271","3":"3.985","4":"-2.0757","5":"3.970e-02","6":"-16.1467","7":"-0.3948"},{"1":"Days:Subject350","2":"-2.261","3":"3.985","4":"-0.5673","5":"5.714e-01","6":"-10.1366","7":"5.6153"},{"1":"Days:Subject351","2":"-15.331","3":"3.985","4":"-3.8476","5":"1.787e-04","6":"-23.2071","7":"-7.4553"},{"1":"Days:Subject352","2":"-8.198","3":"3.985","4":"-2.0574","5":"4.145e-02","6":"-16.0741","7":"-0.3222"},{"1":"Days:Subject369","2":"-10.417","3":"3.985","4":"-2.6142","5":"9.895e-03","6":"-18.2925","7":"-2.5407"},{"1":"Days:Subject370","2":"-3.709","3":"3.985","4":"-0.9307","5":"3.536e-01","6":"-11.5845","7":"4.1674"},{"1":"Days:Subject371","2":"-12.576","3":"3.985","4":"-3.1562","5":"1.947e-03","6":"-20.4522","7":"-4.7003"},{"1":"Days:Subject372","2":"-10.467","3":"3.985","4":"-2.6267","5":"9.554e-03","6":"-18.3426","7":"-2.5907"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(no.pooling.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sleepstudy<span class="sc">$</span>no.pooling.fit <span class="ot">=</span> <span class="fu">fitted</span>(no.pooling.fit)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the model results</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sleepstudy, <span class="fu">aes</span>(<span class="at">x =</span> Days, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> complete.pooling.fit), <span class="at">color =</span> <span class="st">"darkgray"</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> no.pooling.fit), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For example, letâ€™s look at the estimates for the first two subjects (308 and 309), fitted independently using stratification:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(<span class="fu">lm</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days, <span class="at">data =</span> <span class="fu">subset</span>(sleepstudy, Subject <span class="sc">==</span> <span class="dv">308</span>)), <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"244.19","3":"28.08","4":"8.695","5":"0.00002385","6":"179.434","7":"309.0"},{"1":"Days","2":"21.76","3":"5.26","4":"4.137","5":"0.00326466","6":"9.634","7":"33.9"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(<span class="fu">lm</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days, <span class="at">data =</span> <span class="fu">subset</span>(sleepstudy, Subject <span class="sc">==</span> <span class="dv">309</span>)), <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"205.055","3":"5.2162","4":"39.311","5":"1.927e-10","6":"193.026448","7":"217.083"},{"1":"Days","2":"2.262","3":"0.9771","4":"2.315","5":"4.931e-02","6":"0.008641","7":"4.515"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="statistical-model-and-bayesian-estimates-1" class="level3">
<h3 class="anchored" data-anchor-id="statistical-model-and-bayesian-estimates-1">Statistical model and Bayesian estimates</h3>
<p><span class="math display">\[
\begin{aligned}
  \text{Reaction}_{ij} &amp;\sim \text{Normal}(\mu_{ij}, \sigma) \\
  \mu_{ij} &amp;= a_j + b_j \times \text{Days}_{ij} \\
  a_j &amp;\sim \text{Normal}(250, 100) \\
  b_j &amp;\sim \text{Normal}(0, 100) \\
  \sigma &amp;\sim \text{Exponential}(0.1)
\end{aligned}
\]</span></p>
<ul>
<li><span class="math inline">\(a_j\)</span> is the <strong>subject-specific intercept</strong> for <span class="math inline">\(\text{Subject}_j\)</span></li>
<li><span class="math inline">\(b_j\)</span> is the <strong>subject-specific slope</strong> for <span class="math inline">\(\text{Subject}_j\)</span></li>
<li><span class="math inline">\(\sigma\)</span> is the residual standard deviation</li>
<li>Each subject has <strong>completely independent</strong> intercepts and slopes, meaning there is <strong>no sharing of information</strong> between subjects</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>no.pooling.fit <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    Reaction <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a_subject[Subject] <span class="sc">+</span> b_subject[Subject] <span class="sc">*</span> Days,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    a_subject[Subject] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">250</span>, <span class="dv">100</span>),  </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    b_subject[Subject] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(no.pooling.fit, <span class="at">depth =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["5.5%"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["94.5%"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["rhat"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["ess_bulk"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"243.783","2":"14.620","3":"220.398","4":"267.717","5":"1.0021","6":"4020","_rn_":"a_subject[1]"},{"1":"205.943","2":"14.514","3":"182.814","4":"229.612","5":"1.0005","6":"3127","_rn_":"a_subject[2]"},{"1":"204.285","2":"15.315","3":"179.882","4":"228.312","5":"1.0022","6":"3450","_rn_":"a_subject[3]"},{"1":"288.865","2":"13.929","3":"267.062","4":"311.382","5":"1.0004","6":"3262","_rn_":"a_subject[4]"},{"1":"285.130","2":"14.312","3":"261.906","4":"307.855","5":"1.0001","6":"3109","_rn_":"a_subject[5]"},{"1":"264.403","2":"14.214","3":"241.254","4":"287.538","5":"1.0034","6":"2964","_rn_":"a_subject[6]"},{"1":"273.924","2":"15.156","3":"249.969","4":"297.555","5":"1.0012","6":"3738","_rn_":"a_subject[7]"},{"1":"240.734","2":"15.117","3":"216.053","4":"264.966","5":"1.0008","6":"2883","_rn_":"a_subject[8]"},{"1":"262.676","2":"14.740","3":"239.229","4":"285.532","5":"1.0037","6":"2617","_rn_":"a_subject[9]"},{"1":"289.047","2":"14.315","3":"265.545","4":"311.693","5":"1.0023","6":"2574","_rn_":"a_subject[10]"},{"1":"216.306","2":"14.654","3":"192.849","4":"239.696","5":"0.9995","6":"3197","_rn_":"a_subject[11]"},{"1":"226.737","2":"14.839","3":"202.664","4":"249.690","5":"1.0032","6":"3636","_rn_":"a_subject[12]"},{"1":"260.616","2":"14.708","3":"237.493","4":"283.711","5":"1.0015","6":"3109","_rn_":"a_subject[13]"},{"1":"275.900","2":"14.448","3":"252.368","4":"298.807","5":"1.0046","6":"3523","_rn_":"a_subject[14]"},{"1":"255.303","2":"14.994","3":"232.513","4":"279.483","5":"0.9995","6":"3574","_rn_":"a_subject[15]"},{"1":"211.046","2":"14.655","3":"187.555","4":"234.218","5":"1.0004","6":"3314","_rn_":"a_subject[16]"},{"1":"253.821","2":"14.762","3":"230.448","4":"276.731","5":"0.9995","6":"2786","_rn_":"a_subject[17]"},{"1":"266.504","2":"14.985","3":"241.881","4":"290.958","5":"1.0009","6":"3138","_rn_":"a_subject[18]"},{"1":"21.784","2":"2.722","3":"17.309","4":"26.063","5":"1.0007","6":"4114","_rn_":"b_subject[1]"},{"1":"2.145","2":"2.757","3":"-2.338","4":"6.587","5":"1.0008","6":"3088","_rn_":"b_subject[2]"},{"1":"5.923","2":"2.894","3":"1.294","4":"10.479","5":"1.0027","6":"2872","_rn_":"b_subject[3]"},{"1":"3.115","2":"2.667","3":"-1.105","4":"7.417","5":"0.9994","6":"3104","_rn_":"b_subject[4]"},{"1":"5.349","2":"2.674","3":"1.059","4":"9.577","5":"1.0015","6":"3091","_rn_":"b_subject[5]"},{"1":"9.573","2":"2.704","3":"5.194","4":"13.901","5":"1.0028","6":"2806","_rn_":"b_subject[6]"},{"1":"9.294","2":"2.853","3":"4.855","4":"13.811","5":"1.0009","6":"3843","_rn_":"b_subject[7]"},{"1":"12.193","2":"2.832","3":"7.729","4":"16.776","5":"0.9997","6":"2543","_rn_":"b_subject[8]"},{"1":"-2.805","2":"2.715","3":"-7.173","4":"1.545","5":"1.0033","6":"2591","_rn_":"b_subject[9]"},{"1":"19.167","2":"2.660","3":"15.018","4":"23.286","5":"1.0033","6":"2397","_rn_":"b_subject[10]"},{"1":"13.313","2":"2.715","3":"8.951","4":"17.730","5":"1.0003","6":"3240","_rn_":"b_subject[11]"},{"1":"19.416","2":"2.768","3":"15.018","4":"23.889","5":"1.0022","6":"3386","_rn_":"b_subject[12]"},{"1":"6.503","2":"2.751","3":"2.161","4":"10.799","5":"1.0002","6":"3351","_rn_":"b_subject[13]"},{"1":"13.679","2":"2.738","3":"9.247","4":"18.076","5":"1.0003","6":"3735","_rn_":"b_subject[14]"},{"1":"11.270","2":"2.827","3":"6.690","4":"15.790","5":"1.0002","6":"3369","_rn_":"b_subject[15]"},{"1":"17.952","2":"2.727","3":"13.592","4":"22.220","5":"1.0024","6":"3214","_rn_":"b_subject[16]"},{"1":"9.167","2":"2.820","3":"4.789","4":"13.587","5":"1.0001","6":"2691","_rn_":"b_subject[17]"},{"1":"11.373","2":"2.818","3":"6.961","4":"15.919","5":"1.0004","6":"3218","_rn_":"b_subject[18]"},{"1":"25.512","2":"1.497","3":"23.291","4":"28.036","5":"1.0003","6":"2273","_rn_":"sigma"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Instead of using the <code>ulam()</code> function from the <code>rethinking</code> package, you can the <code>stan_glm()</code> function from the <code>rstanarm</code> package to fit the Bayesian model using the <code>lm</code> syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>no.pooling.fit <span class="ot">&lt;-</span> rstanarm<span class="sc">::</span><span class="fu">stan_glm</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">+</span> Subject <span class="sc">+</span> Days<span class="sc">:</span>Subject, <span class="at">data =</span> sleepstudy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(no.pooling.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"245.301","3":"14.933"},{"1":"Days","2":"21.526","3":"2.744"},{"1":"Subject309","2":"-39.880","3":"21.438"},{"1":"Subject310","2":"-41.833","3":"22.175"},{"1":"Subject330","2":"44.164","3":"21.276"},{"1":"Subject331","2":"40.158","3":"21.782"},{"1":"Subject332","2":"18.991","3":"21.206"},{"1":"Subject333","2":"29.219","3":"20.878"},{"1":"Subject334","2":"-5.188","3":"21.296"},{"1":"Subject335","2":"17.175","3":"21.267"},{"1":"Subject337","2":"44.081","3":"21.839"},{"1":"Subject349","2":"-30.205","3":"21.511"},{"1":"Subject350","2":"-18.821","3":"21.098"},{"1":"Subject351","2":"15.669","3":"21.828"},{"1":"Subject352","2":"30.737","3":"21.087"},{"1":"Subject369","2":"9.999","3":"21.220"},{"1":"Subject370","2":"-34.913","3":"21.273"},{"1":"Subject371","2":"7.733","3":"20.817"},{"1":"Subject372","2":"21.015","3":"21.245"},{"1":"Days:Subject309","2":"-19.291","3":"4.069"},{"1":"Days:Subject310","2":"-15.391","3":"4.084"},{"1":"Days:Subject330","2":"-18.369","3":"4.111"},{"1":"Days:Subject331","2":"-16.079","3":"4.064"},{"1":"Days:Subject332","2":"-11.860","3":"3.892"},{"1":"Days:Subject333","2":"-12.263","3":"3.925"},{"1":"Days:Subject334","2":"-9.166","3":"4.006"},{"1":"Days:Subject335","2":"-24.381","3":"3.897"},{"1":"Days:Subject337","2":"-2.345","3":"4.042"},{"1":"Days:Subject349","2":"-7.982","3":"3.998"},{"1":"Days:Subject350","2":"-2.074","3":"4.055"},{"1":"Days:Subject351","2":"-15.075","3":"4.135"},{"1":"Days:Subject352","2":"-7.879","3":"4.088"},{"1":"Days:Subject369","2":"-10.196","3":"4.015"},{"1":"Days:Subject370","2":"-3.504","3":"3.977"},{"1":"Days:Subject371","2":"-12.272","3":"3.875"},{"1":"Days:Subject372","2":"-10.108","3":"3.992"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(no.pooling.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="partial-pooling-mixed-model-random-intercept-and-slope" class="level2">
<h2 class="anchored" data-anchor-id="partial-pooling-mixed-model-random-intercept-and-slope">Partial pooling (mixed model, random intercept and slope)</h2>
<p>One line for each subject (in red). Information is shared across subjects such that each individual line is â€œshrinkedâ€ toward the â€œaverageâ€ line (specified by the fixed intercept and slope and which is the same as the line fitted by the complete pooling model).</p>
<section id="maximum-likelihood-frequentist-estimates-2" class="level3">
<h3 class="anchored" data-anchor-id="maximum-likelihood-frequentist-estimates-2">Maximum-likelihood (frequentist) estimates</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>partial.pooling.fit <span class="ot">=</span> <span class="fu">lmer</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">|</span> Subject), <span class="at">data =</span> sleepstudy)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(partial.pooling.fit, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["effect"],"name":[1],"type":["chr"],"align":["left"]},{"label":["group"],"name":[2],"type":["chr"],"align":["left"]},{"label":["term"],"name":[3],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"fixed","2":"NA","3":"(Intercept)","4":"251.40510","5":"6.825","6":"36.838","7":"238.029","8":"264.8"},{"1":"fixed","2":"NA","3":"Days","4":"10.46729","5":"1.546","6":"6.771","7":"7.438","8":"13.5"},{"1":"ran_pars","2":"Subject","3":"sd__(Intercept)","4":"24.74066","5":"NA","6":"NA","7":"NA","8":"NA"},{"1":"ran_pars","2":"Subject","3":"cor__(Intercept).Days","4":"0.06555","5":"NA","6":"NA","7":"NA","8":"NA"},{"1":"ran_pars","2":"Subject","3":"sd__Days","4":"5.92214","5":"NA","6":"NA","7":"NA","8":"NA"},{"1":"ran_pars","2":"Residual","3":"sd__Observation","4":"25.59180","5":"NA","6":"NA","7":"NA","8":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(partial.pooling.fit)<span class="sc">$</span>Subject</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Days"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"253.7","2":"19.6663","_rn_":"308"},{"1":"211.0","2":"1.8476","_rn_":"309"},{"1":"212.4","2":"5.0184","_rn_":"310"},{"1":"275.1","2":"5.6529","_rn_":"330"},{"1":"273.7","2":"7.3974","_rn_":"331"},{"1":"260.4","2":"10.1951","_rn_":"332"},{"1":"268.2","2":"10.2436","_rn_":"333"},{"1":"244.2","2":"11.5419","_rn_":"334"},{"1":"251.1","2":"-0.2849","_rn_":"335"},{"1":"286.3","2":"19.0956","_rn_":"337"},{"1":"226.2","2":"11.6407","_rn_":"349"},{"1":"238.3","2":"17.0815","_rn_":"350"},{"1":"256.0","2":"7.4520","_rn_":"351"},{"1":"272.3","2":"14.0033","_rn_":"352"},{"1":"254.7","2":"11.3395","_rn_":"369"},{"1":"225.8","2":"15.2898","_rn_":"370"},{"1":"252.2","2":"9.4791","_rn_":"371"},{"1":"263.7","2":"11.7513","_rn_":"372"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(partial.pooling.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sleepstudy<span class="sc">$</span>partial.pooling.fit <span class="ot">=</span> <span class="fu">fitted</span>(partial.pooling.fit)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the model results</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sleepstudy, <span class="fu">aes</span>(<span class="at">x =</span> Days, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> complete.pooling.fit), <span class="at">color =</span> <span class="st">"darkgray"</span>) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> no.pooling.fit), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> partial.pooling.fit), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="statistical-model-and-bayesian-estimates-2" class="level3">
<h3 class="anchored" data-anchor-id="statistical-model-and-bayesian-estimates-2">Statistical model and Bayesian estimates</h3>
<p><span class="math display">\[
\begin{aligned}
  \text{Reaction}_{ij} &amp;\sim \text{Normal}(\mu_{ij}, \sigma) \\
  \mu_{ij} &amp;= \alpha + \beta \times \text{Days}_{ij} + \alpha_j + \beta_j \times \text{Days}_{ij} \\
  \alpha &amp;\sim \text{Normal}(250, 100) \\
  \beta &amp;\sim \text{Normal}(0, 100) \\
  \alpha_j &amp;\sim \text{Normal}(0, \sigma_{\alpha}) \quad \text{for each subject } j  \\
  \beta_j &amp;\sim \text{Normal}(0, \sigma_{\beta}) \quad \text{for each subject } j  \\
  \sigma_{\alpha} &amp;\sim \text{Exponential}(0.1) \\
  \sigma_{\beta} &amp;\sim \text{Exponential}(0.1) \\
  \sigma &amp;\sim \text{Exponential}(0.1)
\end{aligned}
\]</span></p>
<ul>
<li><span class="math inline">\(\alpha\)</span> is the <strong>global mean intercept</strong> across subjects</li>
<li><span class="math inline">\(\beta\)</span> is the <strong>global mean slope</strong> across subjects</li>
<li><span class="math inline">\(\alpha_j\)</span> is the <strong>subject-specific deviation in intercept</strong> from <span class="math inline">\(\alpha\)</span></li>
<li><span class="math inline">\(\beta_j\)</span> is the <strong>subject-specific deviation in slope</strong> from <span class="math inline">\(\beta\)</span></li>
<li><span class="math inline">\(\sigma_{\alpha}\)</span> and <span class="math inline">\(\sigma_{\beta}\)</span> control how much individual subjects vary from the global mean</li>
<li><span class="math inline">\(\sigma\)</span> is the residual standard deviation</li>
<li>Subjects <strong>partially share</strong> information, meaning individual parameters are regularized toward the global estimates</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>partial.pooling.fit <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    Reaction <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> Days <span class="sc">+</span> alpha_subject[Subject] <span class="sc">+</span> beta_subject[Subject] <span class="sc">*</span> Days,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">250</span>, <span class="dv">100</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    alpha_subject[Subject] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, sigma_alpha),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    beta_subject[Subject] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, sigma_beta),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    sigma_beta <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>),</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(partial.pooling.fit, <span class="at">depth =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["5.5%"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["94.5%"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["rhat"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["ess_bulk"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"251.4546","2":"6.533","3":"240.9693","4":"262.2503","5":"1.0020","6":"1020.8","_rn_":"alpha"},{"1":"10.5708","2":"1.732","3":"7.8468","4":"13.3988","5":"1.0063","6":"569.9","_rn_":"beta"},{"1":"1.5524","2":"13.116","3":"-18.1925","4":"22.5739","5":"1.0024","6":"1916.0","_rn_":"alpha_subject[1]"},{"1":"-38.5200","2":"13.906","3":"-60.6626","4":"-17.0549","5":"1.0017","6":"1436.8","_rn_":"alpha_subject[2]"},{"1":"-37.2595","2":"13.931","3":"-60.2346","4":"-15.3975","5":"1.0033","6":"1347.2","_rn_":"alpha_subject[3]"},{"1":"23.0552","2":"13.271","3":"2.6786","4":"44.8756","5":"1.0013","6":"1358.9","_rn_":"alpha_subject[4]"},{"1":"21.7778","2":"13.524","3":"0.2429","4":"44.0593","5":"1.0014","6":"1305.4","_rn_":"alpha_subject[5]"},{"1":"8.6056","2":"12.688","3":"-11.2936","4":"29.0550","5":"1.0009","6":"1875.8","_rn_":"alpha_subject[6]"},{"1":"16.6551","2":"13.186","3":"-4.1756","4":"37.6693","5":"1.0025","6":"1670.5","_rn_":"alpha_subject[7]"},{"1":"-7.5156","2":"13.307","3":"-28.6106","4":"14.0931","5":"1.0013","6":"2052.4","_rn_":"alpha_subject[8]"},{"1":"0.5881","2":"13.605","3":"-21.7607","4":"21.7135","5":"1.0011","6":"1866.2","_rn_":"alpha_subject[9]"},{"1":"32.5429","2":"13.837","3":"10.0693","4":"55.3861","5":"1.0025","6":"1493.7","_rn_":"alpha_subject[10]"},{"1":"-24.5942","2":"12.939","3":"-45.6185","4":"-4.4497","5":"1.0002","6":"1563.6","_rn_":"alpha_subject[11]"},{"1":"-13.3440","2":"12.533","3":"-34.0995","4":"5.5376","5":"1.0003","6":"1496.8","_rn_":"alpha_subject[12]"},{"1":"4.9246","2":"12.492","3":"-15.1748","4":"24.9756","5":"1.0009","6":"1661.2","_rn_":"alpha_subject[13]"},{"1":"19.8408","2":"13.207","3":"-1.6556","4":"40.4182","5":"1.0017","6":"1833.9","_rn_":"alpha_subject[14]"},{"1":"3.0676","2":"12.291","3":"-16.9063","4":"22.4360","5":"1.0029","6":"1699.3","_rn_":"alpha_subject[15]"},{"1":"-25.3780","2":"13.491","3":"-48.0420","4":"-4.0248","5":"1.0019","6":"1659.6","_rn_":"alpha_subject[16]"},{"1":"0.7906","2":"12.617","3":"-19.5569","4":"21.2244","5":"0.9998","6":"2051.2","_rn_":"alpha_subject[17]"},{"1":"11.5075","2":"13.282","3":"-10.5044","4":"32.0937","5":"1.0001","6":"1890.0","_rn_":"alpha_subject[18]"},{"1":"9.2168","2":"2.787","3":"4.6679","4":"13.6676","5":"1.0012","6":"1092.8","_rn_":"beta_subject[1]"},{"1":"-8.9577","2":"2.872","3":"-13.5620","4":"-4.4808","5":"1.0035","6":"1113.5","_rn_":"beta_subject[2]"},{"1":"-5.7635","2":"2.805","3":"-10.2928","4":"-1.3291","5":"1.0024","6":"933.3","_rn_":"beta_subject[3]"},{"1":"-4.8113","2":"2.815","3":"-9.3572","4":"-0.4178","5":"0.9996","6":"1121.0","_rn_":"beta_subject[4]"},{"1":"-3.1107","2":"2.799","3":"-7.6352","4":"1.2677","5":"1.0021","6":"980.2","_rn_":"beta_subject[5]"},{"1":"-0.2921","2":"2.710","3":"-4.6302","4":"3.8425","5":"1.0015","6":"1048.0","_rn_":"beta_subject[6]"},{"1":"-0.3485","2":"2.817","3":"-4.7626","4":"4.0807","5":"1.0001","6":"1077.6","_rn_":"beta_subject[7]"},{"1":"0.9534","2":"2.777","3":"-3.5241","4":"5.3629","5":"1.0007","6":"1135.2","_rn_":"beta_subject[8]"},{"1":"-11.0552","2":"2.971","3":"-15.8286","4":"-6.5002","5":"1.0010","6":"1180.2","_rn_":"beta_subject[9]"},{"1":"8.8096","2":"2.809","3":"4.3044","4":"13.3519","5":"1.0026","6":"1153.0","_rn_":"beta_subject[10]"},{"1":"0.9882","2":"2.709","3":"-3.3875","4":"5.2782","5":"1.0000","6":"1141.5","_rn_":"beta_subject[11]"},{"1":"6.5722","2":"2.631","3":"2.6371","4":"10.8252","5":"1.0011","6":"1283.9","_rn_":"beta_subject[12]"},{"1":"-3.1399","2":"2.628","3":"-7.3486","4":"1.0344","5":"1.0009","6":"1217.4","_rn_":"beta_subject[13]"},{"1":"3.5190","2":"2.742","3":"-0.9594","4":"7.9840","5":"1.0017","6":"1030.3","_rn_":"beta_subject[14]"},{"1":"0.8186","2":"2.686","3":"-3.2183","4":"5.1231","5":"1.0008","6":"1081.8","_rn_":"beta_subject[15]"},{"1":"4.7144","2":"2.830","3":"0.2170","4":"9.2189","5":"1.0030","6":"1095.6","_rn_":"beta_subject[16]"},{"1":"-1.1099","2":"2.710","3":"-5.5867","4":"3.1848","5":"0.9998","6":"1152.3","_rn_":"beta_subject[17]"},{"1":"1.3096","2":"2.778","3":"-3.0498","4":"5.6421","5":"1.0016","6":"1170.0","_rn_":"beta_subject[18]"},{"1":"23.7725","2":"5.458","3":"15.8758","4":"32.6744","5":"1.0031","6":"1118.7","_rn_":"sigma_alpha"},{"1":"6.3446","2":"1.353","3":"4.5024","4":"8.6630","5":"1.0027","6":"1464.7","_rn_":"sigma_beta"},{"1":"25.6556","2":"1.510","3":"23.3070","4":"28.0853","5":"1.0018","6":"2056.5","_rn_":"sigma"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Instead of using the <code>ulam()</code> function from the <code>rethinking</code> package, you can the <code>stan_glmer()</code> function from the <code>rstanarm</code> package to fit the Bayesian model using the <code>lmer</code> syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>partial.pooling.fit <span class="ot">&lt;-</span> <span class="fu">stan_glmer</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">|</span> Subject), <span class="at">data =</span> sleepstudy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(partial.pooling.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"251.52037","3":"6.375","4":"NA"},{"1":"Days","2":"10.52718","3":"1.650","4":"NA"},{"1":"sd_(Intercept).Subject","2":"23.92361","3":"NA","4":"Subject"},{"1":"sd_Days.Subject","2":"6.83838","3":"NA","4":"Subject"},{"1":"cor_(Intercept).Days.Subject","2":"0.08339","3":"NA","4":"Subject"},{"1":"sd_Observation.Residual","2":"26.03567","3":"NA","4":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(partial.pooling.fit, <span class="at">pars =</span> <span class="fu">vars</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"Sigma"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="partial-pooling-mixed-model-random-intercept-and-fixed-slope" class="level2">
<h2 class="anchored" data-anchor-id="partial-pooling-mixed-model-random-intercept-and-fixed-slope">Partial pooling (mixed model, random intercept and fixed slope)</h2>
<section id="maximum-likelihood-frequentist-estimates-3" class="level3">
<h3 class="anchored" data-anchor-id="maximum-likelihood-frequentist-estimates-3">Maximum-likelihood (frequentist) estimates</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>partial.pooling.fit.fixed_slope <span class="ot">=</span> <span class="fu">lmer</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Subject), <span class="at">data =</span> sleepstudy)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(partial.pooling.fit.fixed_slope, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["effect"],"name":[1],"type":["chr"],"align":["left"]},{"label":["group"],"name":[2],"type":["chr"],"align":["left"]},{"label":["term"],"name":[3],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"fixed","2":"NA","3":"(Intercept)","4":"251.41","5":"9.7467","6":"25.79","7":"232.302","8":"270.51"},{"1":"fixed","2":"NA","3":"Days","4":"10.47","5":"0.8042","6":"13.02","7":"8.891","8":"12.04"},{"1":"ran_pars","2":"Subject","3":"sd__(Intercept)","4":"37.12","5":"NA","6":"NA","7":"NA","8":"NA"},{"1":"ran_pars","2":"Residual","3":"sd__Observation","4":"30.99","5":"NA","6":"NA","7":"NA","8":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(partial.pooling.fit.fixed_slope)<span class="sc">$</span>Subject</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Days"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"292.2","2":"10.47","_rn_":"308"},{"1":"173.6","2":"10.47","_rn_":"309"},{"1":"188.3","2":"10.47","_rn_":"310"},{"1":"255.8","2":"10.47","_rn_":"330"},{"1":"261.6","2":"10.47","_rn_":"331"},{"1":"259.6","2":"10.47","_rn_":"332"},{"1":"267.9","2":"10.47","_rn_":"333"},{"1":"248.4","2":"10.47","_rn_":"334"},{"1":"206.1","2":"10.47","_rn_":"335"},{"1":"323.6","2":"10.47","_rn_":"337"},{"1":"230.2","2":"10.47","_rn_":"349"},{"1":"265.5","2":"10.47","_rn_":"350"},{"1":"243.5","2":"10.47","_rn_":"351"},{"1":"287.8","2":"10.47","_rn_":"352"},{"1":"258.4","2":"10.47","_rn_":"369"},{"1":"245.0","2":"10.47","_rn_":"370"},{"1":"248.1","2":"10.47","_rn_":"371"},{"1":"269.5","2":"10.47","_rn_":"372"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(partial.pooling.fit.fixed_slope)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>sleepstudy<span class="sc">$</span>partial.pooling.fit.fixed_slope <span class="ot">=</span> <span class="fu">fitted</span>(partial.pooling.fit.fixed_slope)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the model results</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sleepstudy, <span class="fu">aes</span>(<span class="at">x =</span> Days, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> complete.pooling.fit), <span class="at">color =</span> <span class="st">"darkgray"</span>) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> no.pooling.fit), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> partial.pooling.fit.fixed_slope), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="statistical-model-and-bayesian-estimates-3" class="level3">
<h3 class="anchored" data-anchor-id="statistical-model-and-bayesian-estimates-3">Statistical model and Bayesian estimates</h3>
<p><span class="math display">\[
\begin{aligned}
  \text{Reaction}_{ij} &amp;\sim \text{Normal}(\mu_{ij}, \sigma) \\
  \mu_{ij} &amp;= \alpha + \beta \times \text{Days}_{ij} + \alpha_j \\
  \alpha &amp;\sim \text{Normal}(250, 100) \\
  \beta &amp;\sim \text{Normal}(0, 100) \\
  \alpha_j &amp;\sim \text{Normal}(0, \sigma_{\alpha}) \quad \text{for each subject } j  \\
  \sigma_{\alpha} &amp;\sim \text{Exponential}(0.1) \\
  \sigma &amp;\sim \text{Exponential}(0.1)
\end{aligned}
\]</span></p>
<ul>
<li><span class="math inline">\(\alpha\)</span> is the <strong>global mean intercept</strong> across subjects</li>
<li><span class="math inline">\(\beta\)</span> is the <strong>global slope</strong> (fixed effect of <span class="math inline">\(\text{Days}\)</span>)</li>
<li><span class="math inline">\(\alpha_j\)</span> is the <strong>subject-specific deviation in intercept</strong> from <span class="math inline">\(\alpha\)</span></li>
<li><span class="math inline">\(\sigma_{\alpha}\)</span> controls how much intercepts vary across subjects</li>
<li><span class="math inline">\(\sigma\)</span> is the residual standard deviation</li>
<li>Subjects <strong>share the same slope</strong> but have <strong>varying intercepts</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>partial.pooling.fit.fixed_slope <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    Reaction <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> Days <span class="sc">+</span> alpha_subject[Subject],</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">250</span>, <span class="dv">100</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    alpha_subject[Subject] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, sigma_alpha),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(partial.pooling.fit.fixed_slope, <span class="at">depth =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["5.5%"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["94.5%"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["rhat"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["ess_bulk"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"251.098","2":"9.0369","3":"236.354","4":"265.920","5":"1.016","6":"304.6","_rn_":"alpha"},{"1":"10.462","2":"0.7996","3":"9.115","4":"11.723","5":"1.002","6":"1243.5","_rn_":"beta"},{"1":"40.632","2":"12.2040","3":"20.874","4":"60.006","5":"1.010","6":"583.9","_rn_":"alpha_subject[1]"},{"1":"-76.754","2":"12.1750","3":"-96.502","4":"-57.580","5":"1.008","6":"570.5","_rn_":"alpha_subject[2]"},{"1":"-62.096","2":"11.6974","3":"-80.164","4":"-43.657","5":"1.007","6":"543.6","_rn_":"alpha_subject[3]"},{"1":"4.603","2":"12.5905","3":"-15.782","4":"25.009","5":"1.010","6":"516.2","_rn_":"alpha_subject[4]"},{"1":"10.722","2":"12.6180","3":"-9.165","4":"31.051","5":"1.010","6":"571.0","_rn_":"alpha_subject[5]"},{"1":"8.339","2":"11.9473","3":"-10.729","4":"27.698","5":"1.006","6":"585.3","_rn_":"alpha_subject[6]"},{"1":"16.513","2":"12.2413","3":"-2.911","4":"36.139","5":"1.009","6":"590.5","_rn_":"alpha_subject[7]"},{"1":"-2.316","2":"12.3803","3":"-21.557","4":"17.768","5":"1.007","6":"554.6","_rn_":"alpha_subject[8]"},{"1":"-44.569","2":"12.4256","3":"-64.016","4":"-24.903","5":"1.008","6":"582.3","_rn_":"alpha_subject[9]"},{"1":"71.493","2":"12.2715","3":"52.159","4":"91.254","5":"1.007","6":"588.7","_rn_":"alpha_subject[10]"},{"1":"-20.688","2":"12.2834","3":"-40.507","4":"-1.604","5":"1.013","6":"486.0","_rn_":"alpha_subject[11]"},{"1":"14.084","2":"12.1912","3":"-5.401","4":"34.131","5":"1.009","6":"514.7","_rn_":"alpha_subject[12]"},{"1":"-7.531","2":"11.8636","3":"-26.442","4":"10.725","5":"1.011","6":"554.6","_rn_":"alpha_subject[13]"},{"1":"36.226","2":"12.2233","3":"16.807","4":"56.667","5":"1.011","6":"475.6","_rn_":"alpha_subject[14]"},{"1":"6.651","2":"12.0321","3":"-12.926","4":"25.684","5":"1.007","6":"503.7","_rn_":"alpha_subject[15]"},{"1":"-6.040","2":"12.3655","3":"-24.694","4":"13.992","5":"1.010","6":"522.8","_rn_":"alpha_subject[16]"},{"1":"-2.899","2":"12.4783","3":"-23.271","4":"17.032","5":"1.008","6":"605.0","_rn_":"alpha_subject[17]"},{"1":"18.173","2":"11.8781","3":"0.054","4":"36.755","5":"1.012","6":"517.1","_rn_":"alpha_subject[18]"},{"1":"35.528","2":"5.6631","3":"27.520","4":"44.772","5":"1.002","6":"1502.0","_rn_":"sigma_alpha"},{"1":"30.914","2":"1.6837","3":"28.376","4":"33.858","5":"1.003","6":"1385.1","_rn_":"sigma"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Instead of using the <code>ulam()</code> function from the <code>rethinking</code> package, you can the <code>stan_glmer()</code> function from the <code>rstanarm</code> package to fit the Bayesian model using the <code>lmer</code> syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>partial.pooling.fit.fixed_slope <span class="ot">&lt;-</span> <span class="fu">stan_glmer</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Subject), <span class="at">data =</span> sleepstudy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(partial.pooling.fit.fixed_slope)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"251.39","3":"9.8209","4":"NA"},{"1":"Days","2":"10.46","3":"0.7982","4":"NA"},{"1":"sd_(Intercept).Subject","2":"38.94","3":"NA","4":"Subject"},{"1":"sd_Observation.Residual","2":"31.22","3":"NA","4":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(partial.pooling.fit.fixed_slope, <span class="at">pars =</span> <span class="fu">vars</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"Sigma"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="partial-pooling-mixed-model-fixed-intercept-and-random-slope" class="level2">
<h2 class="anchored" data-anchor-id="partial-pooling-mixed-model-fixed-intercept-and-random-slope">Partial pooling (mixed model, fixed intercept and random slope)</h2>
<section id="maximum-likelihood-frequentist-estimates-4" class="level3">
<h3 class="anchored" data-anchor-id="maximum-likelihood-frequentist-estimates-4">Maximum-likelihood (frequentist) estimates</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>partial.pooling.fit.fixed_intercept <span class="ot">=</span> <span class="fu">lmer</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> Days <span class="sc">|</span> Subject), <span class="at">data =</span> sleepstudy)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(partial.pooling.fit.fixed_intercept, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["effect"],"name":[1],"type":["chr"],"align":["left"]},{"label":["group"],"name":[2],"type":["chr"],"align":["left"]},{"label":["term"],"name":[3],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"fixed","2":"NA","3":"(Intercept)","4":"251.41","5":"4.02","6":"62.539","7":"243.526","8":"259.28"},{"1":"fixed","2":"NA","3":"Days","4":"10.47","5":"1.87","6":"5.599","7":"6.803","8":"14.13"},{"1":"ran_pars","2":"Subject","3":"sd__Days","4":"7.26","5":"NA","6":"NA","7":"NA","8":"NA"},{"1":"ran_pars","2":"Residual","3":"sd__Observation","4":"29.02","5":"NA","6":"NA","7":"NA","8":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(partial.pooling.fit.fixed_intercept)<span class="sc">$</span>Subject</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["(Intercept)"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Days"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"251.4","2":"20.0867","_rn_":"308"},{"1":"251.4","2":"-4.2327","_rn_":"309"},{"1":"251.4","2":"-0.8189","_rn_":"310"},{"1":"251.4","2":"9.1274","_rn_":"330"},{"1":"251.4","2":"10.6755","_rn_":"331"},{"1":"251.4","2":"11.5353","_rn_":"332"},{"1":"251.4","2":"12.7430","_rn_":"333"},{"1":"251.4","2":"10.4775","_rn_":"334"},{"1":"251.4","2":"-0.4337","_rn_":"335"},{"1":"251.4","2":"24.3577","_rn_":"337"},{"1":"251.4","2":"7.9069","_rn_":"349"},{"1":"251.4","2":"15.2012","_rn_":"350"},{"1":"251.4","2":"8.1042","_rn_":"351"},{"1":"251.4","2":"17.1350","_rn_":"352"},{"1":"251.4","2":"11.8341","_rn_":"369"},{"1":"251.4","2":"11.5299","_rn_":"370"},{"1":"251.4","2":"9.5899","_rn_":"371"},{"1":"251.4","2":"13.5923","_rn_":"372"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_autocorrelation</span>(partial.pooling.fit.fixed_intercept)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: Autocorrelated residuals detected (p &lt; .001).</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>sleepstudy<span class="sc">$</span>partial.pooling.fit.fixed_intercept <span class="ot">=</span> <span class="fu">fitted</span>(partial.pooling.fit.fixed_intercept)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the model results</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sleepstudy, <span class="fu">aes</span>(<span class="at">x =</span> Days, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> complete.pooling.fit), <span class="at">color =</span> <span class="st">"darkgray"</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> no.pooling.fit), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> partial.pooling.fit.fixed_intercept), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Subject)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="statistical-model-and-bayesian-estimates-4" class="level3">
<h3 class="anchored" data-anchor-id="statistical-model-and-bayesian-estimates-4">Statistical model and Bayesian estimates</h3>
<p><span class="math display">\[
\begin{aligned}
  \text{Reaction}_{ij} &amp;\sim \text{Normal}(\mu_{ij}, \sigma) \\
  \mu_{ij} &amp;= \alpha + \beta \times \text{Days}_{ij} + \beta_j \times \text{Days}_{ij} \\
  \alpha &amp;\sim \text{Normal}(250, 100) \\
  \beta &amp;\sim \text{Normal}(0, 100) \\
  \beta_j &amp;\sim \text{Normal}(0, \sigma_{\beta}) \\
  \sigma_{\beta} &amp;\sim \text{Exponential}(0.1) \\
  \sigma &amp;\sim \text{Exponential}(0.1)
\end{aligned}
\]</span></p>
<ul>
<li><span class="math inline">\(\alpha\)</span> is the <strong>global mean intercept</strong> across subjects</li>
<li><span class="math inline">\(\beta\)</span> is the <strong>global mean slope</strong> across subjects</li>
<li><span class="math inline">\(\beta_j\)</span> is the <strong>subject-specific deviation in slope</strong> from <span class="math inline">\(\beta\)</span></li>
<li><span class="math inline">\(\sigma_{\beta}\)</span> controls how much slopes vary across subjects</li>
<li><span class="math inline">\(\sigma\)</span> is the residual standard deviation</li>
<li>Subjects <strong>share the same intercept</strong> but have <strong>varying slopes</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>partial.pooling.fit.fixed_intercept <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    Reaction <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> Days <span class="sc">+</span> beta_subject[Subject] <span class="sc">*</span> Days,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">250</span>, <span class="dv">100</span>),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    beta_subject[Subject] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, sigma_beta),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    sigma_beta <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.1</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data =</span> dat, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(partial.pooling.fit.fixed_intercept, <span class="at">depth =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["5.5%"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["94.5%"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["rhat"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["ess_bulk"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"251.47816","2":"3.983","3":"244.9984","4":"257.8245","5":"1.002","6":"952.6","_rn_":"alpha"},{"1":"10.75969","2":"1.686","3":"8.0543","4":"13.4083","5":"1.010","6":"267.0","_rn_":"beta"},{"1":"9.35033","2":"2.190","3":"5.9871","4":"12.8119","5":"1.005","6":"514.1","_rn_":"beta_subject[1]"},{"1":"-15.02579","2":"2.195","3":"-18.5762","4":"-11.5399","5":"1.008","6":"464.9","_rn_":"beta_subject[2]"},{"1":"-11.50353","2":"2.226","3":"-14.9826","4":"-7.9894","5":"1.012","6":"399.5","_rn_":"beta_subject[3]"},{"1":"-1.63355","2":"2.219","3":"-4.9987","4":"2.0458","5":"1.007","6":"406.1","_rn_":"beta_subject[4]"},{"1":"-0.04184","2":"2.175","3":"-3.2795","4":"3.5568","5":"1.005","6":"463.2","_rn_":"beta_subject[5]"},{"1":"0.77173","2":"2.232","3":"-2.6797","4":"4.2697","5":"1.008","6":"444.4","_rn_":"beta_subject[6]"},{"1":"1.95366","2":"2.248","3":"-1.5815","4":"5.6290","5":"1.003","6":"440.1","_rn_":"beta_subject[7]"},{"1":"-0.25140","2":"2.211","3":"-3.7377","4":"3.3309","5":"1.005","6":"456.9","_rn_":"beta_subject[8]"},{"1":"-11.15439","2":"2.256","3":"-14.7158","4":"-7.5187","5":"1.007","6":"458.2","_rn_":"beta_subject[9]"},{"1":"13.59186","2":"2.209","3":"10.0508","4":"17.1153","5":"1.004","6":"461.5","_rn_":"beta_subject[10]"},{"1":"-2.87102","2":"2.230","3":"-6.4489","4":"0.7393","5":"1.009","6":"409.1","_rn_":"beta_subject[11]"},{"1":"4.45502","2":"2.202","3":"0.9244","4":"8.0465","5":"1.006","6":"468.0","_rn_":"beta_subject[12]"},{"1":"-2.65380","2":"2.227","3":"-6.2259","4":"0.9405","5":"1.006","6":"428.3","_rn_":"beta_subject[13]"},{"1":"6.35604","2":"2.201","3":"2.8151","4":"9.9363","5":"1.008","6":"368.1","_rn_":"beta_subject[14]"},{"1":"1.09174","2":"2.198","3":"-2.3764","4":"4.6909","5":"1.005","6":"500.6","_rn_":"beta_subject[15]"},{"1":"0.75059","2":"2.198","3":"-2.7549","4":"4.1110","5":"1.006","6":"429.8","_rn_":"beta_subject[16]"},{"1":"-1.13417","2":"2.238","3":"-4.6258","4":"2.5692","5":"1.005","6":"468.7","_rn_":"beta_subject[17]"},{"1":"2.78653","2":"2.260","3":"-0.7366","4":"6.4744","5":"1.008","6":"447.8","_rn_":"beta_subject[18]"},{"1":"7.53883","2":"1.385","3":"5.6436","4":"9.9130","5":"1.004","6":"970.6","_rn_":"sigma_beta"},{"1":"28.94644","2":"1.612","3":"26.5415","4":"31.6010","5":"1.002","6":"930.4","_rn_":"sigma"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Instead of using the <code>ulam()</code> function from the <code>rethinking</code> package, you can the <code>stan_glmer()</code> function from the <code>rstanarm</code> package to fit the Bayesian model using the <code>lmer</code> syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>partial.pooling.fit.fixed_intercept <span class="ot">&lt;-</span> <span class="fu">stan_glmer</span>(Reaction <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Days <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> Days <span class="sc">|</span> Subject), <span class="at">data =</span> sleepstudy, )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(partial.pooling.fit.fixed_intercept)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"251.333","3":"4.001","4":"NA"},{"1":"Days","2":"10.519","3":"1.965","4":"NA"},{"1":"sd_Days.Subject","2":"7.976","3":"NA","4":"Subject"},{"1":"sd_Observation.Residual","2":"29.112","3":"NA","4":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(partial.pooling.fit.fixed_intercept, <span class="at">pars =</span> <span class="fu">vars</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"Sigma"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="compare-models" class="level2">
<h2 class="anchored" data-anchor-id="compare-models">Compare models</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_performance</span>(complete.pooling.fit, no.pooling.fit, partial.pooling.fit, partial.pooling.fit.fixed_slope, partial.pooling.fit.fixed_intercept)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Model"],"name":[2],"type":["chr"],"align":["left"]},{"label":["ELPD"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ELPD_SE"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["LOOIC"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["LOOIC_wt"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["LOOIC_SE"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["WAIC"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["WAIC_wt"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["R2"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["R2_adjusted"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["RMSE"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["Sigma"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["R2_marginal"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["R2_adjusted_marginal"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["ICC"],"name":[16],"type":["dbl"],"align":["right"]}],"data":[{"1":"complete.pooling.fit","2":"stanreg","3":"-953.3","4":"10.47","5":"1907","6":"4.875e-02","7":"20.93","8":"1907","9":"8.007e-41","10":"0.2834","11":"0.2760","12":"47.45","13":"47.88","14":"NA","15":"NA","16":"NA"},{"1":"no.pooling.fit","2":"stanreg","3":"-863.8","4":"23.20","5":"1728","6":"5.239e-01","7":"46.39","8":"1724","9":"3.195e-01","10":"0.8075","11":"0.7470","12":"22.89","13":"25.72","14":"NA","15":"NA","16":"NA"},{"1":"partial.pooling.fit","2":"stanreg","3":"-862.8","4":"22.74","5":"1726","6":"4.273e-01","7":"45.47","8":"1723","9":"6.805e-01","10":"0.7908","11":"0.7509","12":"23.71","13":"25.99","14":"0.2888","15":"0.7509","16":"0.7501"},{"1":"partial.pooling.fit.fixed_slope","2":"stanreg","3":"-885.1","4":"14.34","5":"1770","6":"3.383e-07","7":"28.69","8":"1770","9":"4.258e-11","10":"0.6979","11":"0.6639","12":"29.43","13":"31.16","14":"0.2863","15":"0.6639","16":"0.6097"},{"1":"partial.pooling.fit.fixed_intercept","2":"stanreg","3":"-875.1","4":"17.98","5":"1750","6":"6.102e-06","7":"35.96","8":"1749","9":"1.311e-06","10":"0.7364","11":"0.7040","12":"27.52","13":"29.03","14":"0.2885","15":"0.7040","16":"0.6826"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="print-environment" class="level2">
<h2 class="anchored" data-anchor-id="print-environment">Print environment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>â”€ Session info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 setting  value
 version  R version 4.4.3 (2025-02-28)
 os       macOS Sequoia 15.3.2
 system   aarch64, darwin20
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/New_York
 date     2025-04-01
 pandoc   3.2 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64/ (via rmarkdown)
 quarto   1.6.42 @ /usr/local/bin/quarto

â”€ Packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 package        * version     date (UTC) lib source
 abind            1.4-8       2024-09-12 [1] CRAN (R 4.4.1)
 backports        1.5.0       2024-05-23 [1] CRAN (R 4.4.0)
 base64enc        0.1-3       2015-07-28 [1] CRAN (R 4.4.0)
 bayesplot      * 1.11.1      2024-02-15 [1] CRAN (R 4.4.0)
 bayestestR     * 0.15.2      2025-02-07 [1] CRAN (R 4.4.1)
 boot             1.3-31      2024-08-28 [2] CRAN (R 4.4.3)
 broom            1.0.7       2024-09-26 [1] CRAN (R 4.4.1)
 broom.mixed    * 0.2.9.6     2024-10-15 [1] CRAN (R 4.4.1)
 checkmate        2.3.2       2024-07-29 [1] CRAN (R 4.4.0)
 cli              3.6.4       2025-02-13 [1] CRAN (R 4.4.1)
 cmdstanr       * 0.8.1       2024-06-06 [1] https://stan-dev.r-universe.dev (R 4.4.0)
 coda             0.19-4.1    2024-01-31 [1] CRAN (R 4.4.0)
 codetools        0.2-20      2024-03-31 [2] CRAN (R 4.4.3)
 colorspace       2.1-1       2024-07-26 [1] CRAN (R 4.4.0)
 colourpicker     1.3.0       2023-08-21 [1] CRAN (R 4.4.0)
 correlation    * 0.8.7       2025-03-03 [1] CRAN (R 4.4.1)
 crosstalk        1.2.1       2023-11-23 [1] CRAN (R 4.4.0)
 curl             6.2.2       2025-03-24 [1] CRAN (R 4.4.1)
 data.table       1.17.0      2025-02-22 [1] CRAN (R 4.4.1)
 datawizard     * 1.0.2       2025-03-24 [1] CRAN (R 4.4.1)
 digest         * 0.6.37      2024-08-19 [1] CRAN (R 4.4.1)
 distributional   0.5.0       2024-09-17 [1] CRAN (R 4.4.1)
 dplyr          * 1.1.4       2023-11-17 [1] CRAN (R 4.4.0)
 DT               0.33        2024-04-04 [1] CRAN (R 4.4.0)
 dygraphs         1.1.1.6     2018-07-11 [1] CRAN (R 4.4.0)
 easystats      * 0.7.4       2025-02-06 [1] CRAN (R 4.4.1)
 effectsize     * 1.0.0       2024-12-10 [1] CRAN (R 4.4.1)
 emmeans          1.11.0      2025-03-20 [1] CRAN (R 4.4.1)
 estimability     1.5.1       2024-05-12 [1] CRAN (R 4.4.0)
 evaluate         1.0.3       2025-01-10 [1] CRAN (R 4.4.1)
 farver           2.1.2       2024-05-13 [1] CRAN (R 4.4.0)
 fastmap          1.2.0       2024-05-15 [1] CRAN (R 4.4.0)
 forcats        * 1.0.0       2023-01-29 [1] CRAN (R 4.4.0)
 furrr            0.3.1       2022-08-15 [1] CRAN (R 4.4.0)
 future           1.34.0      2024-07-29 [1] CRAN (R 4.4.0)
 generics         0.1.3       2022-07-05 [1] CRAN (R 4.4.0)
 ggplot2        * 3.5.1       2024-04-23 [1] CRAN (R 4.4.0)
 ggrepel          0.9.6       2024-09-07 [1] CRAN (R 4.4.1)
 ggridges         0.5.6       2024-01-23 [1] CRAN (R 4.4.0)
 globals          0.16.3      2024-03-08 [1] CRAN (R 4.4.0)
 glue             1.8.0       2024-09-30 [1] CRAN (R 4.4.1)
 gridExtra        2.3         2017-09-09 [1] CRAN (R 4.4.0)
 gtable           0.3.6       2024-10-25 [1] CRAN (R 4.4.1)
 gtools           3.9.5       2023-11-20 [1] CRAN (R 4.4.0)
 hms              1.1.3       2023-03-21 [1] CRAN (R 4.4.0)
 htmltools        0.5.8.1     2024-04-04 [1] CRAN (R 4.4.0)
 htmlwidgets      1.6.4       2023-12-06 [1] CRAN (R 4.4.0)
 httpuv           1.6.15      2024-03-26 [1] CRAN (R 4.4.0)
 igraph           2.1.4       2025-01-23 [1] CRAN (R 4.4.1)
 inline           0.3.21      2025-01-09 [1] CRAN (R 4.4.1)
 insight        * 1.1.0       2025-03-01 [1] CRAN (R 4.4.1)
 jsonlite         2.0.0       2025-03-27 [1] CRAN (R 4.4.1)
 knitr            1.50        2025-03-16 [1] CRAN (R 4.4.1)
 labeling         0.4.3       2023-08-29 [1] CRAN (R 4.4.0)
 later            1.4.1       2024-11-27 [1] CRAN (R 4.4.1)
 lattice          0.22-6      2024-03-20 [2] CRAN (R 4.4.3)
 lifecycle        1.0.4       2023-11-07 [1] CRAN (R 4.4.0)
 listenv          0.9.1       2024-01-29 [1] CRAN (R 4.4.0)
 lme4           * 1.1-37      2025-03-26 [1] CRAN (R 4.4.1)
 loo              2.8.0       2024-07-03 [1] CRAN (R 4.4.0)
 lubridate      * 1.9.4       2024-12-08 [1] CRAN (R 4.4.1)
 magrittr         2.0.3       2022-03-30 [1] CRAN (R 4.4.0)
 markdown         2.0         2025-03-23 [1] CRAN (R 4.4.1)
 MASS             7.3-64      2025-01-04 [2] CRAN (R 4.4.3)
 Matrix         * 1.7-2       2025-01-23 [2] CRAN (R 4.4.3)
 matrixStats      1.5.0       2025-01-07 [1] CRAN (R 4.4.1)
 mgcv             1.9-1       2023-12-21 [2] CRAN (R 4.4.3)
 mime             0.13        2025-03-17 [1] CRAN (R 4.4.1)
 miniUI           0.1.1.1     2018-05-18 [1] CRAN (R 4.4.0)
 minqa            1.2.8       2024-08-17 [1] CRAN (R 4.4.0)
 modelbased     * 0.10.0      2025-03-10 [1] CRAN (R 4.4.1)
 multcomp         1.4-28      2025-01-29 [1] CRAN (R 4.4.1)
 munsell          0.5.1       2024-04-01 [1] CRAN (R 4.4.0)
 mvtnorm          1.3-3       2025-01-10 [1] CRAN (R 4.4.1)
 nlme             3.1-167     2025-01-27 [2] CRAN (R 4.4.3)
 nloptr           2.2.1       2025-03-17 [1] CRAN (R 4.4.1)
 parallelly       1.43.0      2025-03-24 [1] CRAN (R 4.4.1)
 parameters     * 0.24.2      2025-03-04 [1] CRAN (R 4.4.1)
 patchwork        1.3.0       2024-09-16 [1] CRAN (R 4.4.1)
 performance    * 0.13.0      2025-01-15 [1] CRAN (R 4.4.1)
 pillar           1.10.1      2025-01-07 [1] CRAN (R 4.4.1)
 pkgbuild         1.4.7       2025-03-24 [1] CRAN (R 4.4.1)
 pkgconfig        2.0.3       2019-09-22 [1] CRAN (R 4.4.0)
 plyr             1.8.9       2023-10-02 [1] CRAN (R 4.4.0)
 posterior      * 1.6.1       2025-02-27 [1] CRAN (R 4.4.1)
 processx         3.8.6       2025-02-21 [1] CRAN (R 4.4.1)
 promises         1.3.2       2024-11-28 [1] CRAN (R 4.4.1)
 ps               1.9.0       2025-02-18 [1] CRAN (R 4.4.1)
 purrr          * 1.0.4       2025-02-05 [1] CRAN (R 4.4.1)
 QuickJSR         1.6.0       2025-02-26 [1] CRAN (R 4.4.1)
 R6               2.6.1       2025-02-15 [1] CRAN (R 4.4.1)
 rbibutils        2.3         2024-10-04 [1] CRAN (R 4.4.1)
 Rcpp           * 1.0.14      2025-01-12 [1] CRAN (R 4.4.1)
 RcppParallel     5.1.10      2025-01-24 [1] CRAN (R 4.4.1)
 Rdpack           2.6.3       2025-03-16 [1] CRAN (R 4.4.1)
 readr          * 2.1.5       2024-01-10 [1] CRAN (R 4.4.0)
 reformulas       0.4.0       2024-11-03 [1] CRAN (R 4.4.1)
 report         * 0.6.1       2025-02-07 [1] CRAN (R 4.4.1)
 reshape2         1.4.4       2020-04-09 [1] CRAN (R 4.4.0)
 rethinking     * 2.42        2025-03-19 [1] Github (rmcelreath/rethinking@ac1b3b2)
 rlang            1.1.5       2025-01-17 [1] CRAN (R 4.4.1)
 rmarkdown        2.29        2024-11-04 [1] CRAN (R 4.4.1)
 rstan            2.35.0.9000 2024-06-06 [1] https://stan-dev.r-universe.dev (R 4.4.0)
 rstanarm       * 2.32.1      2024-01-18 [1] CRAN (R 4.4.0)
 rstantools       2.4.0       2024-01-31 [1] CRAN (R 4.4.0)
 rstudioapi       0.17.1      2024-10-22 [1] CRAN (R 4.4.1)
 sandwich         3.1-1       2024-09-15 [1] CRAN (R 4.4.1)
 scales           1.3.0       2023-11-28 [1] CRAN (R 4.4.0)
 see            * 0.11.0      2025-03-11 [1] CRAN (R 4.4.1)
 sessioninfo      1.2.3       2025-02-05 [1] CRAN (R 4.4.1)
 shape            1.4.6.1     2024-02-23 [1] CRAN (R 4.4.0)
 shiny            1.10.0      2024-12-14 [1] CRAN (R 4.4.1)
 shinyjs          2.1.0       2021-12-23 [1] CRAN (R 4.4.0)
 shinystan        2.6.0       2022-03-03 [1] CRAN (R 4.4.0)
 shinythemes      1.2.0       2021-01-25 [1] CRAN (R 4.4.0)
 StanHeaders      2.35.0.9000 2024-06-06 [1] https://stan-dev.r-universe.dev (R 4.4.0)
 stringi          1.8.7       2025-03-27 [1] CRAN (R 4.4.1)
 stringr        * 1.5.1       2023-11-14 [1] CRAN (R 4.4.0)
 survival         3.8-3       2024-12-17 [2] CRAN (R 4.4.3)
 tensorA          0.36.2.1    2023-12-13 [1] CRAN (R 4.4.0)
 TH.data          1.1-3       2025-01-17 [1] CRAN (R 4.4.1)
 threejs          0.3.3       2020-01-21 [1] CRAN (R 4.4.0)
 tibble         * 3.2.1       2023-03-20 [1] CRAN (R 4.4.0)
 tidyr          * 1.3.1       2024-01-24 [1] CRAN (R 4.4.0)
 tidyselect       1.2.1       2024-03-11 [1] CRAN (R 4.4.0)
 tidyverse      * 2.0.0       2023-02-22 [1] CRAN (R 4.4.0)
 timechange       0.3.0       2024-01-18 [1] CRAN (R 4.4.0)
 tzdb             0.5.0       2025-03-15 [1] CRAN (R 4.4.1)
 V8               6.0.3       2025-03-26 [1] CRAN (R 4.4.1)
 vctrs            0.6.5       2023-12-01 [1] CRAN (R 4.4.0)
 withr            3.0.2       2024-10-28 [1] CRAN (R 4.4.1)
 xfun             0.51        2025-02-19 [1] CRAN (R 4.4.1)
 xtable           1.8-4       2019-04-21 [1] CRAN (R 4.4.0)
 xts              0.14.1      2024-10-15 [1] CRAN (R 4.4.1)
 yaml             2.3.10      2024-07-26 [1] CRAN (R 4.4.0)
 zoo              1.8-13      2025-02-22 [1] CRAN (R 4.4.1)

 [1] /Users/marcoe02/.Rlib
 [2] /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library
 * â”€â”€ Packages attached to the search path.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>